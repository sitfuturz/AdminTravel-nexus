<div class="container-fluid">
  <div class="card border-0 shadow-lg rounded-4 overflow-hidden">
    <div
      class="card-header bg-primary d-flex justify-content-between align-items-center py-3"
    >
      <h4 class="mb-0 fw-bold text-white">
        <i class="bi bi-people-fill me-2"></i>All Members
      </h4>
      <div>
        <button
          class="btn btn-dark rounded-pill me-2 bg-light text-black"
          (click)="exportToExcel()"
          [disabled]="loading || exporting || !users?.docs?.length"
        >
          <i class="bi bi-file-earmark-excel-fill me-2"></i>Export to Excel
        </button>
        <button
          class="btn btn-light rounded-pill me-2 bg-light text-black"
          (click)="exportToPDF()"
          [disabled]="loading || exporting || !users?.docs?.length"
        >
          <i class="bi bi-file-earmark-pdf-fill me-2"></i>Export to PDF
        </button>
      </div>
    </div>
    <div class="card-body p-0">
      <div
        class="d-flex flex-wrap justify-content-between align-items-center p-3 border-bottom"
      >
        <div class="flex-grow-1 me-2">
          <input
            type="text"
            class="form-control"
            placeholder="Search..."
            [(ngModel)]="searchQuery"
            (input)="onSearch()"
          />
        </div>
        <!-- <div class="me-2">
          <ng-select
            id="chapterSelect"
            [items]="chapters"
            bindLabel="name"
            bindValue="name"
            [(ngModel)]="selectedChapter"
            (change)="onChapterChange()"
            placeholder="Select Chapter"
            [clearable]="true"
          >
          </ng-select>
        </div> -->
        <div class="ms-2">
          <ng-select
            id="limitSelect"
            [items]="[10, 25, 50, 100]"
            [(ngModel)]="payload.limit"
            (change)="onChange()"
            placeholder="Items per page"
          >
          </ng-select>
        </div>
      </div>
    </div>

    <div *ngIf="loading" class="text-center my-5 py-5">
      <div class="spinner-grow text-primary" role="status">
        <span class="visually-hidden">Loading...</span>
      </div>
    </div>

    <div
      *ngIf="exporting"
      class="position-fixed top-0 start-0 w-100 h-100 d-flex justify-content-center align-items-center"
      style="background: rgba(0, 0, 0, 0.3); z-index: 1050"
    >
      <div class="bg-white p-4 rounded shadow-lg text-center">
        <div class="spinner-border text-primary mb-3" role="status">
          <span class="visually-hidden">Exporting...</span>
        </div>
        <p class="mb-0">Preparing export file...</p>
      </div>
    </div>

    <div class="table-responsive" *ngIf="!loading && users?.docs?.length > 0">
      <table class="table table-hover align-middle mb-0">
        <thead class="bg-light">
          <tr>
            <th class="ps-4 py-3">Name</th>
            <th class="py-3">Business</th>
            <th class="py-3">Mobile</th>
            <th class="py-3">Email</th>
            <!-- <th class="py-3">DigitalCardLink</th>
            <th class="py-3">User Type</th> -->
            <!-- <th class="py-3">Status</th> -->
            <th class="text-end pe-4 py-3">Action</th>
          </tr>
        </thead>
        <tbody>
          <tr
            *ngFor="
              let user of users?.docs
                | paginate
                  : {
                      id: paginationConfig.id,
                      itemsPerPage: payload.limit,
                      currentPage: payload.page,
                      totalItems: users?.totalDocs
                    };
              let i = index
            "
            class="border-bottom"
          >
            <td class="ps-4 py-3">
              <div class="d-flex align-items-center">
                <!-- <img
                  [src]="
                    user.profilePic
                      ? imageurl + user.profilePic
                      : '/assets/images/placeholder-image.png'
                  "
                  class="rounded-circle me-3 shadow-sm border-2 border-white"
                  width="48"
                  height="48"
                  alt="User"
                  onerror="this.src='assets/images/placeholder-image.png'"
                /> -->
                <div>
                  <div class="fw-bold text-dark">
                    {{ user.name || "Unknown User" }}
                  </div>
                  <small class="text-muted d-block"
                    >ID:
                    {{ user._id ? user._id.substring(0, 8) : "N/A" }}</small
                  >
                </div>
              </div>
            </td>
            <td class="py-3">
              <span class="d-flex align-items-center">{{
                user.business_name || "N/A"
              }}</span>
              <!-- <small class="text-muted" *ngIf="user.business && user.business.length > 0 && user.business[0].about_business_details">
                {{user.business[0].about_business_details | slice:0:25}}{{user.business[0].about_business_details.length > 25 ? '...' : ''}}
              </small> -->
            </td>
            <td class="py-3">
              <span class="d-flex align-items-center">
                <i class="bi bi-telephone-fill text-muted me-2"></i>
                {{ user.mobile_number || "N/A" }}
              </span>
            </td>
            <td class="py-3">
              <span class="d-flex align-items-center">
                <i class="bi bi-envelope-fill text-muted me-2"></i>
                {{ user.email || "N/A" }}
              </span>
            </td>
            <!-- <td class="py-3">
              <ng-container *ngIf="user.digitalCardLink; else noLink">
                <a [href]="user.digitalCardLink" target="_blank" class="text-primary">
                  <i class="bi bi-link-45deg me-2"></i>Digital Card
                </a>
              </ng-container>
              <ng-template #noLink>N/A</ng-template>
            </td>
            <td class="py-3">
              <span class="badge rounded-pill px-3 py-2 bg-primary bg-opacity-10 text-primary">
                {{user.meeting_role || 'N/A'}}
              </span>
            </td> -->
            <!-- <td class="py-3">
              <span class="badge rounded-pill"
                    [ngClass]="user.isActive ? 'badge bg-success' : 'badge bg-danger'"
                    style="cursor: pointer;"
                    (click)="toggleUserStatus(user)">
                {{user.isActive ? 'Active' : 'Inactive'}}
              </span>
            </td> -->
            <td class="text-end pe-4 py-3">
              <div class="dropdown">
                <button
                  class="btn btn-sm btn-outline-primary rounded-pill dropdown-toggle"
                  type="button"
                  data-bs-toggle="dropdown"
                  aria-expanded="false"
                >
                  Actions
                </button>
                <ul class="dropdown-menu dropdown-menu-end shadow-sm border-0">
                  <li>
                    <a
                      class="dropdown-item"
                      (click)="viewUserDetails(user)"
                      style="cursor: pointer"
                    >
                      <i class="bi bi-eye-fill me-2 text-primary"></i> View
                      Details
                    </a>
                  </li>
                  <li>
                    <a
                      class="dropdown-item"
                      (click)="editUser(user)"
                      style="cursor: pointer"
                    >
                      <i class="bi bi-pencil-fill me-2 text-warning"></i> Edit
                    </a>
                  </li>
                  <li>
                    <a
                      class="dropdown-item"
                      (click)="openNotificationModal(user)"
                      style="cursor: pointer"
                    >
                      <i class="bi bi-bell-fill me-2 text-info"></i> Send
                      Notification
                    </a>
                  </li>
                  <li>
                    <a
                      class="dropdown-item text-danger"
                      (click)="deleteUser(user._id)"
                      style="cursor: pointer"
                    >
                      <i class="bi bi-trash-fill me-2"></i> Delete
                    </a>
                  </li>
                </ul>
              </div>
            </td>
          </tr>
        </tbody>
      </table>

      <div
        class="d-flex justify-content-between align-items-center p-3 border-top"
      >
        <div *ngIf="users?.docs?.length > 0" class="text-muted">
          Showing {{ (payload.page - 1) * payload.limit + 1 }} to
          {{ Math.min(payload.page * payload.limit, users.totalDocs) }}
          of {{ users.totalDocs }} entries
        </div>
        <pagination-controls
          [id]="paginationConfig.id"
          (pageChange)="onPageChange($event)"
          previousLabel="Previous"
          nextLabel="Next"
          [directionLinks]="true"
        >
        </pagination-controls>
      </div>
    </div>

    <div
      *ngIf="!loading && (!users?.docs || users?.docs.length === 0)"
      class="text-center my-5 py-4 px-4"
    >
      <div class="empty-state">
        <i class="bi bi-search fs-1 text-muted mb-3"></i>
        <h5>No Users Found</h5>
        <p class="text-muted">
          Try adjusting your search criteria or check back later.
        </p>
      </div>
    </div>
  </div>
</div>

<!-- User Details Modal -->
<div
  class="modal fade"
  id="userDetailsModal"
  tabindex="-1"
  data-bs-backdrop="static"
  data-bs-keyboard="false"
  role="dialog"
  aria-labelledby="modalTitleId"
  aria-hidden="true"
>
  <div
    class="modal-dialog modal-dialog-scrollable modal-dialog-centered modal-lg"
    role="document"
  >
    <div class="modal-content border-0 shadow rounded-4 overflow-hidden">
      <div class="modal-header bg-gradient-primary text-white">
        <h5 class="modal-title" id="modalTitleId">
          <i class="bi bi-person-badge-fill me-2"></i> User Details
        </h5>
        <button
          type="button"
          class="btn-close btn-close-black"
          data-bs-dismiss="modal"
          aria-label="Close"
        ></button>
      </div>

      <div class="modal-body p-4" *ngIf="selectedUser">
        <!-- Tab Navigation -->
        <ul class="nav nav-tabs mb-4">
          <li class="nav-item">
            <a
              class="nav-link"
              [class.active]="activeTab === 'profile'"
              (click)="setActiveTab('profile')"
              style="cursor: pointer"
              >Profile</a
            >
          </li>
          <!-- <li class="nav-item">
            <a class="nav-link" [class.active]="activeTab === 'referrals'" (click)="setActiveTab('referrals')" style="cursor: pointer;">Referrals</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" [class.active]="activeTab === 'pdf'" (click)="setActiveTab('pdf')" style="cursor: pointer;">PDF</a>
          </li> -->
        </ul>
        <!-- Profile Tab Content -->
        <div *ngIf="activeTab === 'profile' && selectedUser">
          <div class="row">
            <!-- Left Column - Profile Info -->
            <div class="col-md-12">
              <div class="card border-0 shadow-sm rounded-4 mb-4">
                <div class="card-body text-center">
                  <img
                    [src]="
                      selectedUser.profilePic
                        ? imageurl + selectedUser.profilePic
                        : '/assets/images/placeholder-image.png'
                    "
                    class="img-fluid rounded-circle mb-3 shadow-sm border-3 border-white"
                    style="width: 180px; height: 180px; object-fit: cover"
                    alt="User Image"
                    onerror="this.src='assets/images/placeholder-image.png'"
                  />

                  <h4 class="mb-1 mt-2">
                    {{ selectedUser.name || "Unknown User" }}
                  </h4>

                  <div class="mt-2">
                    <span class="badge bg-light text-dark px-3 py-2">
                      {{ selectedUser.city || "N/A" }},
                      {{ selectedUser.state || "N/A" }}
                    </span>
                  </div>
                </div>
              </div>

              <!-- Contact Information Card -->
              <div class="card border-0 shadow-sm rounded-4 mb-4">
                <div class="card-header bg-light py-3">
                  <h6 class="mb-0 fw-bold">
                    <i class="bi bi-person-lines-fill me-2"></i> Contact
                    Information
                  </h6>
                </div>
                <div class="card-body">
                  <div class="mb-3">
                    <p class="mb-1 text-muted small">
                      <i class="bi bi-telephone-fill me-2"></i>Mobile:
                    </p>
                    <p class="fw-bold">
                      {{ selectedUser.mobile_number || "N/A" }}
                    </p>
                  </div>
                  <div class="mb-3">
                    <p class="mb-1 text-muted small">
                      <i class="bi bi-envelope-fill me-2"></i>Email:
                    </p>
                    <p class="fw-bold">{{ selectedUser.email || "N/A" }}</p>
                  </div>
                  <div class="mb-3">
                    <p class="mb-1 text-muted small">
                      <i class="bi bi-geo-alt-fill me-2"></i>Location:
                    </p>
                    <p class="fw-bold">
                      {{ selectedUser.city || "N/A" }},
                      {{ selectedUser.state || "N/A" }},
                      {{ selectedUser.country || "N/A" }}
                    </p>
                  </div>
                </div>
              </div>

              <!-- Business Info -->
              <div
                class="card border-0 shadow-sm rounded-4 mb-4"
                *ngIf="selectedUser.business_name"
              >
                <div class="card-header bg-light py-3">
                  <h6 class="mb-0 fw-bold">
                    <i class="bi bi-building me-2"></i> Business Information
                  </h6>
                </div>
                <div class="card-body">
                  <p class="mb-1 text-muted small">Business Name:</p>
                  <p class="fw-bold">{{ selectedUser.business_name }}</p>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Referrals Tab Content -->
        <div *ngIf="activeTab === 'referrals'">
          <div class="card border-0 shadow-sm rounded-4 mb-3">
            <div class="card-header bg-light py-3">
              <h6 class="mb-0 fw-bold">
                <i class="bi bi-share-fill me-2"></i> Referral History
              </h6>
            </div>
            <div class="card-body">
              <!-- Sub-tabs for Given and Received Referrals -->
              <ul class="nav nav-pills mb-3">
                <li class="nav-item">
                  <a
                    class="nav-link"
                    [class.active]="referralTab === 'given'"
                    (click)="setReferralTab('given')"
                    style="cursor: pointer"
                    >Given</a
                  >
                </li>
                <li class="nav-item">
                  <a
                    class="nav-link"
                    [class.active]="referralTab === 'received'"
                    (click)="setReferralTab('received')"
                    style="cursor: pointer"
                    >Received</a
                  >
                </li>
              </ul>
              <!-- Loading State -->
              <div *ngIf="referralLoading" class="text-center my-5">
                <div class="spinner-grow text-primary" role="status">
                  <span class="visually-hidden">Loading...</span>
                </div>
              </div>
              <!-- Given Referrals -->
              <div *ngIf="referralTab === 'given' && !referralLoading">
                <div *ngIf="referralsGiven.length > 0; else noGivenReferrals">
                  <div class="table-responsive">
                    <table class="table table-hover align-middle">
                      <thead class="bg-light">
                        <tr>
                          <th>Receiver</th>
                          <th>Type</th>
                          <th>Rating</th>
                          <th>Status</th>
                          <th>Date</th>
                        </tr>
                      </thead>
                      <tbody>
                        <tr
                          *ngFor="
                            let referral of referralsGiven
                              | paginate
                                : {
                                    id: referralPaginationConfig.givenId,
                                    itemsPerPage: referralPayload.limit,
                                    currentPage: referralPayload.givenPage,
                                    totalItems: referralsGivenTotal
                                  };
                            let i = index
                          "
                        >
                          <td>{{ referral.receiver_id?.name || "N/A" }}</td>
                          <td>{{ referral.referral_type | titlecase }}</td>
                          <td>{{ referral.rating || "N/A" }}</td>
                          <td>
                            <span
                              class="badge"
                              [ngClass]="{
                                'bg-success':
                                  referral.referral_status.given_card,
                                'bg-warning':
                                  !referral.referral_status.given_card
                              }"
                            >
                              {{
                                referral.referral_status.given_card
                                  ? "Card Given"
                                  : "Pending"
                              }}
                            </span>
                          </td>
                          <td>
                            {{ referral.createdAt | date : "mediumDate" }}
                          </td>
                        </tr>
                      </tbody>
                    </table>
                  </div>
                  <div
                    class="d-flex justify-content-between align-items-center p-3 border-top"
                  >
                    <div *ngIf="referralsGiven.length > 0" class="text-muted">
                      Showing
                      {{
                        (referralPayload.givenPage - 1) *
                          referralPayload.limit +
                          1
                      }}
                      to
                      {{
                        Math.min(
                          referralPayload.givenPage * referralPayload.limit,
                          referralsGivenTotal
                        )
                      }}
                      of {{ referralsGivenTotal }} entries
                    </div>
                    <pagination-controls
                      [id]="referralPaginationConfig.givenId"
                      (pageChange)="onGivenReferralPageChange($event)"
                      previousLabel="Previous"
                      nextLabel="Next"
                      [directionLinks]="true"
                    >
                    </pagination-controls>
                  </div>
                </div>
                <ng-template #noGivenReferrals>
                  <div class="text-center py-4">
                    <i class="bi bi-info-circle fs-1 text-muted mb-3"></i>
                    <p>No referrals given by this user.</p>
                  </div>
                </ng-template>
              </div>
              <!-- Received Referrals -->
              <div *ngIf="referralTab === 'received' && !referralLoading">
                <div
                  *ngIf="referralsReceived.length > 0; else noReceivedReferrals"
                >
                  <div class="table-responsive">
                    <table class="table table-hover align-middle">
                      <thead class="bg-light">
                        <tr>
                          <th>Giver</th>
                          <th>Type</th>
                          <th>Rating</th>
                          <th>Status</th>
                          <th>Date</th>
                        </tr>
                      </thead>
                      <tbody>
                        <tr
                          *ngFor="
                            let referral of referralsReceived
                              | paginate
                                : {
                                    id: referralPaginationConfig.receivedId,
                                    itemsPerPage: referralPayload.limit,
                                    currentPage: referralPayload.receivedPage,
                                    totalItems: referralsReceivedTotal
                                  };
                            let i = index
                          "
                        >
                          <td>{{ referral.giver_id?.name || "N/A" }}</td>
                          <td>{{ referral.referral_type | titlecase }}</td>
                          <td>{{ referral.rating || "N/A" }}</td>
                          <td>
                            <span
                              class="badge"
                              [ngClass]="{
                                'bg-success':
                                  referral.referral_status.given_card,
                                'bg-warning':
                                  !referral.referral_status.given_card
                              }"
                            >
                              {{
                                referral.referral_status.given_card
                                  ? "Card Given"
                                  : "Pending"
                              }}
                            </span>
                          </td>
                          <td>
                            {{ referral.createdAt | date : "mediumDate" }}
                          </td>
                        </tr>
                      </tbody>
                    </table>
                  </div>
                  <div
                    class="d-flex justify-content-between align-items-center p-3 border-top"
                  >
                    <div
                      *ngIf="referralsReceived.length > 0"
                      class="text-muted"
                    >
                      Showing
                      {{
                        (referralPayload.receivedPage - 1) *
                          referralPayload.limit +
                          1
                      }}
                      to
                      {{
                        Math.min(
                          referralPayload.receivedPage * referralPayload.limit,
                          referralsReceivedTotal
                        )
                      }}
                      of {{ referralsReceivedTotal }} entries
                    </div>
                    <pagination-controls
                      [id]="referralPaginationConfig.receivedId"
                      (pageChange)="onReceivedReferralPageChange($event)"
                      previousLabel="Previous"
                      nextLabel="Next"
                      [directionLinks]="true"
                    >
                    </pagination-controls>
                  </div>
                </div>
                <ng-template #noReceivedReferrals>
                  <div class="text-center py-4">
                    <i class="bi bi-info-circle fs-1 text-muted mb-3"></i>
                    <p>No referrals received by this user.</p>
                  </div>
                </ng-template>
              </div>
            </div>
          </div>
        </div>
        <!-- PDF Tab Content -->
        <div *ngIf="activeTab === 'pdf'">
          <div class="card border-0 shadow-sm rounded-4 mb-3">
            <div class="card-header bg-light py-3">
              <h6 class="mb-0 fw-bold">
                <i class="bi bi-file-earmark-pdf-fill me-2"></i> Generate PDF
              </h6>
            </div>
            <div class="card-body text-center">
              <p class="text-muted mb-4">
                Click the button below to generate a PDF with the user's
                details, including contact and business information.
              </p>
              <button
                class="btn btn-primary rounded-pill px-4"
                (click)="generateUserPDF()"
                [disabled]="pdfLoading"
              >
                <i class="bi bi-download me-2"></i>
                <span *ngIf="!pdfLoading">Generate PDF</span>
                <span *ngIf="pdfLoading">Generating...</span>
              </button>
            </div>
          </div>
        </div>
      </div>
      <div class="modal-footer">
        <button
          type="button"
          class="btn btn-outline-primary rounded-pill"
          (click)="closeModal()"
        >
          <i class="bi bi-x-circle me-1"></i> Close
        </button>
      </div>
    </div>
  </div>
</div>
<!-- Edit User Modal -->
<div
  class="modal fade"
  id="editUserModal"
  tabindex="-1"
  data-bs-backdrop="static"
  data-bs-keyboard="false"
  role="dialog"
  aria-labelledby="editUserModalTitle"
  aria-hidden="true"
>
  <div class="modal-dialog modal-dialog-centered modal-lg" role="document">
    <div class="modal-content border-0 shadow rounded-4 overflow-hidden">
      <div class="modal-header bg-gradient-primary text-white">
        <h5 class="modal-title" id="editUserModalTitle">
          <i class="bi bi-pencil-fill me-2"></i> Edit User
        </h5>
        <button
          type="button"
          class="btn-close btn-close-black"
          data-bs-dismiss="modal"
          aria-label="Close"
          (click)="closeEditModal()"
        ></button>
      </div>
      <div class="modal-body p-4">
        <form>
          <!-- Personal Information Section -->
          <div class="mb-4">
            <h6 class="text-primary mb-3">Personal Information</h6>
            <div class="row">
              <div class="col-md-6 mb-3">
                <label for="editName" class="form-label"
                  >Name <span class="text-danger">*</span></label
                >
                <input
                  type="text"
                  class="form-control"
                  id="editName"
                  [(ngModel)]="editForm.name"
                  name="name"
                  placeholder="Enter name"
                  required
                />
                <div *ngIf="editError.name" class="text-danger small mt-1">
                  {{ editError.name }}
                </div>
              </div>
              <div class="col-md-6 mb-3">
                <label for="editEmail" class="form-label"
                  >Email <span class="text-danger">*</span></label
                >
                <input
                  type="email"
                  class="form-control"
                  id="editEmail"
                  [(ngModel)]="editForm.email"
                  name="email"
                  placeholder="Enter email"
                  required
                />
                <div *ngIf="editError.email" class="text-danger small mt-1">
                  {{ editError.email }}
                </div>
              </div>
            </div>

            <div class="row">
              <div class="col-md-6 mb-3">
                <label for="editMobile" class="form-label"
                  >Mobile Number <span class="text-danger">*</span></label
                >
                <input
                  type="text"
                  class="form-control"
                  id="editMobile"
                  [(ngModel)]="editForm.mobile_number"
                  name="mobile_number"
                  placeholder="Enter mobile number"
                  maxlength="10"
                  required
                />
                <div
                  *ngIf="editError.mobile_number"
                  class="text-danger small mt-1"
                >
                  {{ editError.mobile_number }}
                </div>
              </div>
              <div class="col-md-6 mb-3">
                <label for="editBusinessName" class="form-label"
                  >Business Name <span class="text-danger">*</span></label
                >
                <input
                  type="text"
                  class="form-control"
                  id="editBusinessName"
                  [(ngModel)]="editForm.business_name"
                  name="business_name"
                  placeholder="Enter business name"
                  required
                />
                <div
                  *ngIf="editError.business_name"
                  class="text-danger small mt-1"
                >
                  {{ editError.business_name }}
                </div>
              </div>
            </div>
          </div>

          <!-- Location Information Section -->
          <div class="mb-4">
            <h6 class="text-primary mb-3">Location Details</h6>
            <div class="row">
              <div class="col-md-4 mb-3">
                <label for="editCountry" class="form-label">Country <span class="text-danger">*</span></label>
                <ng-select 
                  id="editCountry" 
                  [items]="countries" 
                  bindLabel="name" 
                  bindValue="name" 
                  placeholder="Select country"
                  [(ngModel)]="editForm.country" 
                  name="country" 
                  required 
                  [loading]="countriesLoading"
                  [class.is-invalid]="editError.country"
                >
                </ng-select>
                <div class="invalid-feedback" *ngIf="editError.country">
                  {{ editError.country }}
                </div>
              </div>
              <div class="col-md-4 mb-3">
                <label for="editState" class="form-label">State <span class="text-danger">*</span></label>
                <ng-select 
                  id="editState" 
                  [items]="states" 
                  bindLabel="name" 
                  bindValue="name" 
                  placeholder="Select state"
                  [(ngModel)]="editForm.state" 
                  name="state" 
                  required 
                  [loading]="statesLoading"
                  [class.is-invalid]="editError.state"
                >
                </ng-select>
                <div class="invalid-feedback" *ngIf="editError.state">
                  {{ editError.state }}
                </div>
              </div>
              <div class="col-md-4 mb-3">
                <label for="editCity" class="form-label">City <span class="text-danger">*</span></label>
                <ng-select 
                  id="editCity" 
                  [items]="cities" 
                  bindLabel="name" 
                  bindValue="name" 
                  placeholder="Select city"
                  [(ngModel)]="editForm.city" 
                  name="city" 
                  required 
                  [loading]="citiesLoading"
                  [class.is-invalid]="editError.city"
                >
                </ng-select>
                <div class="invalid-feedback" *ngIf="editError.city">
                  {{ editError.city }}
                </div>
              </div>
            </div>
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <button
          type="button"
          class="btn btn-outline-primary rounded-pill"
          (click)="closeEditModal()"
        >
          <i class="bi bi-x-circle me-1"></i> Cancel
        </button>
        <button
          type="button"
          class="btn btn-primary rounded-pill"
          (click)="updateUser()"
          [disabled]="editLoading"
        >
          <i class="bi bi-save-fill me-1"></i>
          <span *ngIf="!editLoading">Save Changes</span>
          <span *ngIf="editLoading">Saving...</span>
        </button>
      </div>
    </div>
  </div>
</div>

<!-- Notification Modal -->
<div
  class="modal fade"
  id="notificationModal"
  tabindex="-1"
  data-bs-backdrop="static"
  data-bs-keyboard="false"
  role="dialog"
  aria-labelledby="notificationModalTitle"
  aria-hidden="true"
>
  <div class="modal-dialog modal-dialog-centered modal-md" role="document">
    <div class="modal-content border-0 shadow rounded-4 overflow-hidden">
      <div class="modal-header bg-gradient-primary text-white">
        <h5 class="modal-title" id="notificationModalTitle">
          <i class="bi bi-bell-fill me-2"></i> Send Notification
        </h5>
        <button
          type="button"
          class="btn-close btn-close-black"
          data-bs-dismiss="modal"
          aria-label="Close"
          (click)="closeNotificationModal()"
        ></button>
      </div>
      <div class="modal-body p-4">
        <form>
          <div class="mb-3">
            <label for="notificationTitle" class="form-label"
              >Title <span class="text-danger">*</span></label
            >
            <input
              type="text"
              class="form-control"
              id="notificationTitle"
              [(ngModel)]="notificationForm.title"
              name="title"
              placeholder="Enter notification title"
              required
            />
            <div *ngIf="notificationError.title" class="text-danger small mt-1">
              {{ notificationError.title }}
            </div>
          </div>
          <div class="mb-3">
            <label for="notificationDescription" class="form-label"
              >Description <span class="text-danger">*</span></label
            >
            <textarea
              class="form-control"
              id="notificationDescription"
              [(ngModel)]="notificationForm.description"
              name="description"
              rows="4"
              placeholder="Enter notification description"
              required
            ></textarea>
            <div
              *ngIf="notificationError.description"
              class="text-danger small mt-1"
            >
              {{ notificationError.description }}
            </div>
          </div>
          <div class="mb-3">
            <label for="notificationMessage" class="form-label"
              >Message (Optional)</label
            >
            <textarea
              class="form-control"
              id="notificationMessage"
              [(ngModel)]="notificationForm.message"
              name="message"
              rows="3"
              placeholder="Enter additional message"
            ></textarea>
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <button
          type="button"
          class="btn btn-outline-primary rounded-pill"
          (click)="closeNotificationModal()"
        >
          <i class="bi bi-x-circle me-1"></i> Cancel
        </button>
        <button
          type="button"
          class="btn btn-primary rounded-pill"
          (click)="sendNotification()"
          [disabled]="notificationLoading"
        >
          <i class="bi bi-send-fill me-1"></i>
          <span *ngIf="!notificationLoading">Send Notification</span>
          <span *ngIf="notificationLoading">Sending...</span>
        </button>
      </div>
    </div>
  </div>
</div>
